<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>iVape Runner</title>
  <style>
    body { margin: 0; overflow: hidden; background: black; }
    canvas { display: block; margin: 0 auto; }
  </style>
</head>
<body>
<canvas id="gameCanvas"></canvas>
<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let score = 0;
let gameOver = false;
let speedMultiplier = 1;
let invertedControl = false;

const groundHeight = 100;
const groundY = canvas.height - groundHeight;

// ===== КАРТИНКИ =====
const playerImg = new Image(); playerImg.src = "images/player.png";
const groundImg = new Image(); groundImg.src = "images/ground.png";
const obstacle1 = new Image(); obstacle1.src = "images/Obstacle1.png"; // сигарета
const obstacle2 = new Image(); obstacle2.src = "images/Obstacle2.png"; // батарейка
const obstacle3 = new Image(); obstacle3.src = "images/Obstacle3.png"; // провод
const bonusGood = new Image(); bonusGood.src = "images/bonusGood.png";
const bonusBad = new Image(); bonusBad.src = "images/bonusBad.png";

// ===== ИГРОК =====
let player = {
  x: 100,
  y: groundY - 80,
  width: 60,
  height: 80,
  vy: 0,
  gravity: 0.6,
  jump: -12,
  crouching: false
};

let obstacles = [];
let bonuses = [];
let frame = 0;

// ===== ОБСТАКЛЫ =====
function createObstacle() {
  let rand = Math.random();
  let o = {x: canvas.width, width: 60, height: 60};

  if (rand < 0.4) {
    o.type = "ground"; // сигарета
    o.y = groundY - o.height;
  } else if (rand < 0.7) {
    o.type = "air"; // батарейка
    o.y = groundY - o.height - 120;
  } else {
    o.type = "wire"; // провод (надо пригибаться)
    o.y = groundY - o.height - 40;
  }
  obstacles.push(o);
}

// ===== БОНУСЫ =====
function createBonus() {
  let type = Math.random() < 0.5 ? "good" : "bad";
  let b = {x: canvas.width, width: 40, height: 40, type: type};
  b.y = groundY - b.height - (type === "good" ? 100 : 50);
  bonuses.push(b);
}

// ===== УПРАВЛЕНИЕ =====
function jump() {
  if (!gameOver && player.y >= groundY - player.height) {
    player.vy = player.jump;
  }
}
function crouchStart() { if (!gameOver) player.crouching = true; }
function crouchEnd() { player.crouching = false; }

document.addEventListener("keydown", e => {
  if (!invertedControl) {
    if (e.code === "Space" || e.code === "ArrowUp") jump();
    if (e.code === "ArrowDown") crouchStart();
  } else {
    if (e.code === "ArrowDown") jump();
    if (e.code === "Space" || e.code === "ArrowUp") crouchStart();
  }
});
document.addEventListener("keyup", e => {
  if (!invertedControl) {
    if (e.code === "ArrowDown") crouchEnd();
  } else {
    if (e.code === "Space" || e.code === "ArrowUp") crouchEnd();
  }
});

// ===== ИГРА =====
function update() {
  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0,0,canvas.width,canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "30px Arial";
    ctx.fillText("Game Over! Счёт: "+score, canvas.width/2-120, canvas.height/2-40);
    ctx.fillText("Нажмите R для рестарта", canvas.width/2-150, canvas.height/2+20);
    return;
  }

  frame++;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // фон
  ctx.fillStyle = "#87CEEB"; // небо
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // земля
  if (groundImg.complete) {
    ctx.drawImage(groundImg,0,groundY,canvas.width,groundHeight);
  } else {
    ctx.fillStyle="green";
    ctx.fillRect(0,groundY,canvas.width,groundHeight);
  }

  // игрок
  player.vy += player.gravity;
  player.y += player.vy;
  if (player.y > groundY - player.height) {
    player.y = groundY - player.height;
    player.vy = 0;
  }
  let drawH = player.crouching ? player.height/2 : player.height;
  let drawY = player.crouching ? player.y+player.height/2 : player.y;
  ctx.drawImage(playerImg, player.x, drawY, player.width, drawH);

  // препятствия
  if (frame % 120 === 0) createObstacle();
  for (let i=obstacles.length-1;i>=0;i--){
    let o = obstacles[i];
    o.x -= 6*speedMultiplier;
    let img = (o.type==="ground"?obstacle1:(o.type==="air"?obstacle2:obstacle3));
    ctx.drawImage(img,o.x,o.y,o.width,o.height);

    if (o.x+o.width<0) obstacles.splice(i,1);

    // хитбоксы
    let pTop = player.y;
    let pBottom = player.crouching ? player.y+player.height/2 : player.y+player.height;
    let pLeft = player.x;
    let pRight = player.x+player.width;

    if (pLeft < o.x+o.width && pRight > o.x && pTop < o.y+o.height && pBottom > o.y) {
      gameOver = true;
    }
  }

  // бонусы
  if (frame % 200 === 0) createBonus();
  for (let i=bonuses.length-1;i>=0;i--){
    let b = bonuses[i];
    b.x -= 6*speedMultiplier;
    let img = (b.type==="good"?bonusGood:bonusBad);
    ctx.drawImage(img,b.x,b.y,b.width,b.height);
    if (b.x+b.width<0) bonuses.splice(i,1);

    let pTop = player.y;
    let pBottom = player.crouching ? player.y+player.height/2 : player.y+player.height;
    let pLeft = player.x;
    let pRight = player.x+player.width;
    if (pLeft < b.x+b.width && pRight > b.x && pTop < b.y+b.height && pBottom > b.y) {
      bonuses.splice(i,1);
      if (b.type==="good") {
        score+=5; speedMultiplier=2;
        setTimeout(()=>{speedMultiplier=1;},5000);
      } else {
        score=Math.max(0,score-10);
        invertedControl=true;
        setTimeout(()=>{invertedControl=false;},5000);
      }
    }
  }

  // счёт
  ctx.fillStyle="black";
  ctx.font="24px Arial";
  ctx.fillText("Счёт: "+score,20,40);

  requestAnimationFrame(update);
}

// рестарт
document.addEventListener("keydown", e=>{
  if (e.code==="KeyR" && gameOver){
    score=0; obstacles=[]; bonuses=[]; frame=0; gameOver=false;
    update();
  }
});

update();
</script>
</body>
</html>
