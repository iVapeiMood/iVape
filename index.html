<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>iVape Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <script>
    // Вставляй сюда весь код, который я прислал
    const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let groundHeight = canvas.height * 0.3;
let groundY = canvas.height - groundHeight;

let playerImg = new Image();
playerImg.src = "images/player.png";

let groundImg = new Image();
groundImg.src = "images/ground.png";

let obstacleImages = {
    "ground": new Image(),
    "air": new Image(),
    "wire": new Image()
};
obstacleImages["ground"].src = "images/Obstacle1.png"; // сигарета
obstacleImages["air"].src = "images/Obstacle2.png";    // батарейка
obstacleImages["wire"].src = "images/Obstacle3.png";   // провод

let bonusGood = new Image();
bonusGood.src = "images/bonusGood.png";
let bonusBad = new Image();
bonusBad.src = "images/bonusBad.png";

// Игрок
let player = {
    x: 50,
    y: groundY - 80,
    width: 50,
    height: 80,
    vy: 0,
    jumping: false,
    crouching: false,
    effectTimer: 0
};

let gravity = 0.6;
let obstacles = [];
let bonuses = [];
let score = 0;
let gameOver = false;
let invertedControl = false;
let speedMultiplier = 1;

// управление (ПК)
document.addEventListener("keydown", e => {
    if (!gameOver) {
        if ((e.code === "ArrowUp" || e.code === "Space") && !player.jumping) {
            player.vy = -12;
            player.jumping = true;
        }
        if (e.code === "ArrowDown") {
            player.crouching = true;
        }
    }
});
document.addEventListener("keyup", e => {
    if (e.code === "ArrowDown") player.crouching = false;
});

// управление (телефон)
let touchStartY = null;
canvas.addEventListener("touchstart", e => {
    touchStartY = e.touches[0].clientY;
});
canvas.addEventListener("touchend", e => {
    let endY = e.changedTouches[0].clientY;
    let deltaY = endY - touchStartY;

    if (!gameOver) {
        if (deltaY < -50 && !player.jumping) {
            player.vy = -12;
            player.jumping = true;
        }
        if (deltaY > 50) {
            player.crouching = true;
            setTimeout(() => player.crouching = false, 500);
        }
    }
});

// создаём препятствия и бонусы
function spawnObstacle() {
    let types = ["ground", "air", "wire"];
    let type = types[Math.floor(Math.random() * types.length)];
    let o = { type: type, x: canvas.width, width: 50, height: 50 };

    if (type === "ground") {
        o.y = groundY - o.height;
    } else if (type === "air") {
        o.y = groundY - 150;
    } else if (type === "wire") {
        o.y = groundY - 100; // высота провода: можно пройти только присев
        o.width = 120;
        o.height = 30;
    }
    obstacles.push(o);
}

function spawnBonus() {
    if (obstacles.length > 0 && Math.random() < 0.7) return; // защита: бонус не поверх преп.
    let type = Math.random() < 0.5 ? "good" : "bad";
    let b = { type: type, x: canvas.width, width: 40, height: 40 };
    b.y = groundY - b.height - 10;
    bonuses.push(b);
}

// обновление игры
function update() {
    if (gameOver) return;

    // гравитация
    player.y += player.vy;
    player.vy += gravity;
    if (player.y + player.height > groundY) {
        player.y = groundY - player.height;
        player.vy = 0;
        player.jumping = false;
    }

    // препятствия
    for (let i = obstacles.length - 1; i >= 0; i--) {
        let o = obstacles[i];
        o.x -= 6 * speedMultiplier;
        if (o.x + o.width < 0) {
            obstacles.splice(i, 1);
            score++;
            continue;
        }
        if (obstacleImages[o.type].complete) {
            ctx.drawImage(obstacleImages[o.type], o.x, o.y, o.width, o.height);
        }

        // хитбокс игрока
        let pTop = player.y;
        let pBottom = player.crouching ? player.y + player.height / 2 : player.y + player.height;
        let pLeft = player.x;
        let pRight = player.x + player.width;

        if (pLeft < o.x + o.width &&
            pRight > o.x &&
            pTop < o.y + o.height &&
            pBottom > o.y) {
            gameOver = true;
        }
    }

    // бонусы
  for (let i = bonuses.length - 1; i >= 0; i--) {
        let b = bonuses[i];
        b.x -= 6 * speedMultiplier;
        if (b.x + b.width < 0) {
            bonuses.splice(i, 1);
            continue;
        }

        let img = (b.type === "good") ? bonusGood : bonusBad;
        if (img.complete) ctx.drawImage(img, b.x, b.y, b.width, b.height);

        let pTop = player.y;
        let pBottom = player.crouching ? player.y + player.height / 2 : player.y + player.height;
        let pLeft = player.x;
        let pRight = player.x + player.width;

        if (pLeft < b.x + b.width &&
            pRight > b.x &&
            pTop < b.y + b.height &&
            pBottom > b.y) {
            bonuses.splice(i, 1);
            if (b.type === "good") {
                score += 5;
                speedMultiplier = 1.5;
                setTimeout(() => speedMultiplier = 1, 5000);
            } else {
                score = Math.max(0, score - 10);
                invertedControl = true;
                setTimeout(() => invertedControl = false, 5000);
            }
        }
    }
}

// рисование
function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // небо
    ctx.fillStyle = "#87CEEB";
    ctx.fillRect(0, 0, canvas.width, groundY);

    // земля
    if (groundImg.complete) {
        ctx.drawImage(groundImg, 0, groundY, canvas.width, groundHeight);
    }

    // игрок
    ctx.drawImage(playerImg, player.x, player.y,
        player.width, player.crouching ? player.height / 2 : player.height);

    // счёт
    ctx.fillStyle = "#000";
    ctx.font = "24px Arial";
    ctx.fillText("Счёт: " + score, 20, 40);
}

function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
}

setInterval(spawnObstacle, 2000);
setInterval(spawnBonus, 5000);

gameLoop();
  </script>
</body>
</html>
